'use strict';
(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('babel-runtime/helpers/classCallCheck'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),require('path'),require('rimraf'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):'function'==typeof define&&define.amd?define('prerenderwebnodeplugin',['babel-runtime/helpers/classCallCheck','babel-runtime/core-js/get-iterator','babel-runtime/core-js/promise','babel-runtime/regenerator','babel-runtime/helpers/asyncToGenerator','child_process','clientnode','path','rimraf','web-node/pluginAPI.compiled','source-map-support/register'],b):'object'==typeof exports?exports.prerenderwebnodeplugin=b(require('babel-runtime/helpers/classCallCheck'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),require('path'),require('rimraf'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):a.prerenderwebnodeplugin=b(a['babel-runtime/helpers/classCallCheck'],a['babel-runtime/core-js/get-iterator'],a['babel-runtime/core-js/promise'],a['babel-runtime/regenerator'],a['babel-runtime/helpers/asyncToGenerator'],a.child_process,a.clientnode,a.path,a.rimraf,a['web-node/pluginAPI.compiled'],a['source-map-support/register'])})('undefined'==typeof self?this:self,function(a,b,c,d,e,f,g,h,i,j,k){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';(function(a){function d(a){return a&&a.__esModule?a:{default:a}}var e=c(3),f=d(e),g=c(4),h=d(g),i=c(5),j=d(i),k=c(6),l=d(k),m=c(7),n=d(m),o=c(8),p=c(9),q=d(p),r=c(10),s=d(r),t=c(11),u=d(t),v=c(12),w=d(v);b.__esModule=!0,b.PreRender=void 0;try{c(13)}catch(a){}var x=b.PreRender=function(){function b(){(0,n.default)(this,b)}return b.postConfigurationLoaded=function(){var a=(0,l.default)(j.default.mark(function a(c,d,e,f){return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c.preRender.renderAfterConfigurationUpdates&&b.render(c,f),a.abrupt('return',c);case 2:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.preLoadService=function(a){return a.preRender={getPrerenderedDirectories:b.getPrerenderedDirectories.bind(b),getPrerendererFiles:b.getPrerendererFiles.bind(b),render:b.render.bind(b),renderFile:b.renderFile.bind(b)},a},b.shouldExit=function(){var a=(0,l.default)(j.default.mark(function a(c,d,e){var g,i,k,l,m,n,o;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g=[],i=function(a){g.push(new h.default(function(b,c){return(0,u.default)(a.path,{glob:!1},function(a){return a?c(a):b()})}))},a.next=4,b.getPrerenderedDirectories(d,e);case 4:k=a.sent,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);case 8:if(!l){a.next=14;break}if(!(m>=k.length)){a.next=11;break}return a.abrupt('break',22);case 11:n=k[m++],a.next=18;break;case 14:if(m=k.next(),!m.done){a.next=17;break}return a.abrupt('break',22);case 17:n=m.value;case 18:o=n,i(o);case 20:a.next=8;break;case 22:return a.next=24,h.default.all(g);case 24:return a.abrupt('return',c);case 25:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.getPrerenderedDirectories=function(){var a=(0,l.default)(j.default.mark(function a(b,c){var d;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.map(function(a){return a.path}),a.next=3,q.default.walkDirectoryRecursively(b.context.path,function(a){if(a.name.startsWith('.'))return!1;for(var c in b.plugin.directories)if(b.plugin.directories.hasOwnProperty(c)&&s.default.dirname(a.path)===s.default.resolve(b.plugin.directories[c].path)&&!d.includes(a.path))return!1;for(var e=b.preRender.locationsToIgnore,g=Array.isArray(e),h=0,e=g?e:(0,f.default)(e);;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{if(h=e.next(),h.done)break;i=h.value}var j=i;if(!j.startsWith('/'))for(var k=d,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);;){var n;if(l){if(m>=k.length)break;n=k[m++]}else{if(m=k.next(),m.done)break;n=m.value}var o=n;if(a.path.startsWith(s.default.resolve(o,j)))return!1}else if(a.path.startsWith(s.default.join(b.context.path,j)))return!1}if(a.stats&&a.stats.isDirectory()&&b.preRender.directoryNames.includes(a.name))return!1});case 3:return a.t0=function(a){return!!(a.stats&&a.stats.isDirectory()&&b.preRender.directoryNames.includes(a.name))},a.abrupt('return',a.sent.filter(a.t0));case 5:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.getPrerendererFiles=function(){var a=(0,l.default)(j.default.mark(function a(b,c){var d;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.map(function(a){return a.path}),a.next=3,q.default.walkDirectoryRecursively(b.context.path,function(a){if(a.name.startsWith('.'))return!1;for(var c in b.plugin.directories)if(b.plugin.directories.hasOwnProperty(c)&&s.default.dirname(a.path)===s.default.resolve(b.plugin.directories[c].path)&&!d.includes(a.path))return!1;for(var e=b.preRender.locationsToIgnore,g=Array.isArray(e),h=0,e=g?e:(0,f.default)(e);;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{if(h=e.next(),h.done)break;i=h.value}var j=i;if(!j.startsWith('/'))for(var k=d,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);;){var n;if(l){if(m>=k.length)break;n=k[m++]}else{if(m=k.next(),m.done)break;n=m.value}var o=n;if(a.path.startsWith(s.default.resolve(o,j)))return!1}else if(a.path.startsWith(s.default.join(b.context.path,j)))return!1}});case 3:return a.t0=function(a){return!!(a.stats&&a.stats.isFile()&&b.preRender.fileBaseNames.includes(s.default.basename(a.name,s.default.extname(a.name))))},a.abrupt('return',a.sent.filter(a.t0));case 5:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.render=function(){var a=(0,l.default)(j.default.mark(function a(c,d){var e,g,i,k,l,m,n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=w.default,a.t1=d,a.t2=c,a.next=5,b.getPrerendererFiles(c,d);case 5:return a.t3=a.sent,a.next=8,a.t0.callStack.call(a.t0,'prePreRendererRender',a.t1,a.t2,a.t3);case 8:e=a.sent,g=[],i=e,k=Array.isArray(i),l=0,i=k?i:(0,f.default)(i);case 11:if(!k){a.next=17;break}if(!(l>=i.length)){a.next=14;break}return a.abrupt('break',34);case 14:m=i[l++],a.next=21;break;case 17:if(l=i.next(),!l.done){a.next=20;break}return a.abrupt('break',34);case 20:m=l.value;case 21:return n=m,a.t4=g,a.t5=b,a.t6=n.path,a.t7=[],a.next=28,w.default.callStack('prePreRendererCLIParameter',d,c,[].concat(o).concat(n.path,c.preRender.cache));case 28:a.t8=a.sent,a.t9=a.t7.concat.call(a.t7,a.t8),a.t10=a.t5.renderFile.call(a.t5,a.t6,a.t9),a.t4.push.call(a.t4,a.t10);case 32:a.next=11;break;case 34:return a.next=36,h.default.all(g);case 36:return a.next=38,w.default.callStack('postPreRendererRender',d,c,e);case 38:return a.abrupt('return',a.sent);case 39:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.renderFile=function(b){var c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return new h.default(function(){var e=(0,l.default)(j.default.mark(function e(g,h){var i,k,l,m,n,p;return j.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=(0,o.spawn)(b,[].concat(d).map(String),{cwd:s.default.dirname(b),env:a.env,shell:!0,stdio:'inherit'}),k=q.default.closeEventNames,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);case 2:if(!l){c.next=8;break}if(!(m>=k.length)){c.next=5;break}return c.abrupt('break',16);case 5:n=k[m++],c.next=12;break;case 8:if(m=k.next(),!m.done){c.next=11;break}return c.abrupt('break',16);case 11:n=m.value;case 12:p=n,i.on(p,q.default.getProcessCloseHandler(g,h));case 14:c.next=2;break;case 16:case'end':return c.stop();}},e,c)}));return function(){return e.apply(this,arguments)}}())},b}();b.default=x}).call(b,c(2))},function(a){function b(){throw new Error('setTimeout has not been defined')}function c(){throw new Error('clearTimeout has not been defined')}function d(a){if(j===setTimeout)return setTimeout(a,0);if((j===b||!j)&&setTimeout)return j=setTimeout,setTimeout(a,0);try{return j(a,0)}catch(b){try{return j.call(null,a,0)}catch(b){return j.call(this,a,0)}}}function e(a){if(k===clearTimeout)return clearTimeout(a);if((k===c||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(a);try{return k(a)}catch(b){try{return k.call(null,a)}catch(b){return k.call(this,a)}}}function f(){o&&m&&(o=!1,m.length?n=m.concat(n):p=-1,n.length&&g())}function g(){if(!o){var a=d(f);o=!0;for(var b=n.length;b;){for(m=n,n=[];++p<b;)m&&m[p].run();p=-1,b=n.length}m=null,o=!1,e(a)}}function h(a,b){this.fun=a,this.array=b}function i(){}var j,k,l=a.exports={};(function(){try{j='function'==typeof setTimeout?setTimeout:b}catch(a){j=b}try{k='function'==typeof clearTimeout?clearTimeout:c}catch(a){k=c}})();var m,n=[],o=!1,p=-1;l.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];n.push(new h(a,b)),1!==n.length||o||d(g)},h.prototype.run=function(){this.fun.apply(null,this.array)},l.title='browser',l.browser=!0,l.env={},l.argv=[],l.version='',l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error('process.binding is not supported')},l.cwd=function(){return'/'},l.chdir=function(){throw new Error('process.chdir is not supported')},l.umask=function(){return 0}},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d},function(a){a.exports=e},function(b){b.exports=a},function(a){a.exports=f},function(a){a.exports=g},function(a){a.exports=h},function(a){a.exports=i},function(a){a.exports=j},function(a){if('undefined'==typeof k){var b=new Error('Cannot find module "source-map-support/register"');throw b.code='MODULE_NOT_FOUND',b}a.exports=k}])});