'use strict';
(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('babel-runtime/helpers/classCallCheck'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),require('path'),require('rimraf'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):'function'==typeof define&&define.amd?define('prerenderwebnodeplugin',['babel-runtime/helpers/classCallCheck','babel-runtime/core-js/get-iterator','babel-runtime/core-js/promise','babel-runtime/regenerator','babel-runtime/helpers/asyncToGenerator','child_process','clientnode','path','rimraf','web-node/pluginAPI.compiled','source-map-support/register'],b):'object'==typeof exports?exports.prerenderwebnodeplugin=b(require('babel-runtime/helpers/classCallCheck'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),require('path'),require('rimraf'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):a.prerenderwebnodeplugin=b(a['babel-runtime/helpers/classCallCheck'],a['babel-runtime/core-js/get-iterator'],a['babel-runtime/core-js/promise'],a['babel-runtime/regenerator'],a['babel-runtime/helpers/asyncToGenerator'],a.child_process,a.clientnode,a.path,a.rimraf,a['web-node/pluginAPI.compiled'],a['source-map-support/register'])})(this,function(a,b,c,d,e,f,g,h,i,j,k){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';(function(a){function d(a){return a&&a.__esModule?a:{default:a}}var e=c(3),f=d(e),g=c(4),h=d(g),i=c(5),j=d(i),k=c(6),l=d(k),m=c(7),n=d(m),o=c(8),p=c(9),q=d(p),r=c(10),s=d(r),t=c(11),u=d(t),v=c(12),w=d(v);b.__esModule=!0,b.PreRender=void 0;try{c(13)}catch(a){}var x=b.PreRender=function(){function b(){(0,n.default)(this,b)}return b.postConfigurationLoaded=function(){var a=(0,l.default)(j.default.mark(function a(c,d,e,f){return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c.preRender.renderAfterConfigurationUpdates&&b.render(c,f),a.abrupt('return',c);case 2:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.preLoadService=function(a){return a.preRender={render:b.render.bind(b)},a},b.shouldExit=function(){var a=(0,l.default)(j.default.mark(function a(c,d,e){var g,i,k,l,m,n,o;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g=[],i=function(a){g.push(new h.default(function(b,c){return(0,u.default)(a.path,{glob:!1},function(a){return a?c(a):b()})}))},a.next=4,b.getPrerenderedDirectories(d,e);case 4:k=a.sent,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);case 8:if(!l){a.next=14;break}if(!(m>=k.length)){a.next=11;break}return a.abrupt('break',22);case 11:n=k[m++],a.next=18;break;case 14:if(m=k.next(),!m.done){a.next=17;break}return a.abrupt('break',22);case 17:n=m.value;case 18:o=n,i(o);case 20:a.next=8;break;case 22:return a.next=24,h.default.all(g);case 24:return a.abrupt('return',c);case 25:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.getPrerenderedDirectories=function(){var a=(0,l.default)(j.default.mark(function a(b,c){var d;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.map(function(a){return a.path}),a.next=3,q.default.walkDirectoryRecursively(b.context.path,function(a){if(a.name.startsWith('.'))return!1;for(var c in b.plugin.directories)if(b.plugin.directories.hasOwnProperty(c)&&s.default.dirname(a.path)===s.default.resolve(b.plugin.directories[c].path)&&!d.includes(a.path))return!1;for(var e=b.preRender.locationsToIgnore,g=Array.isArray(e),h=0,e=g?e:(0,f.default)(e);;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{if(h=e.next(),h.done)break;i=h.value}var j=i;if(!j.startsWith('/'))for(var k=d,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);;){var n;if(l){if(m>=k.length)break;n=k[m++]}else{if(m=k.next(),m.done)break;n=m.value}var o=n;if(a.path.startsWith(s.default.resolve(o,j)))return!1}else if(a.path.startsWith(s.default.join(b.context.path,j)))return!1}if(a.stat.isDirectory()&&b.preRender.directoryNames.includes(a.name))return!1});case 3:return a.t0=function(a){return a.stat.isDirectory()&&b.preRender.directoryNames.includes(a.name)},a.abrupt('return',a.sent.filter(a.t0));case 5:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.getPrerendererFiles=function(){var a=(0,l.default)(j.default.mark(function a(b,c){var d;return j.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.map(function(a){return a.path}),a.next=3,q.default.walkDirectoryRecursively(b.context.path,function(a){if(a.name.startsWith('.'))return!1;for(var c in b.plugin.directories)if(b.plugin.directories.hasOwnProperty(c)&&s.default.dirname(a.path)===s.default.resolve(b.plugin.directories[c].path)&&!d.includes(a.path))return!1;for(var e=b.preRender.locationsToIgnore,g=Array.isArray(e),h=0,e=g?e:(0,f.default)(e);;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{if(h=e.next(),h.done)break;i=h.value}var j=i;if(!j.startsWith('/'))for(var k=d,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);;){var n;if(l){if(m>=k.length)break;n=k[m++]}else{if(m=k.next(),m.done)break;n=m.value}var o=n;if(a.path.startsWith(s.default.resolve(o,j)))return!1}else if(a.path.startsWith(s.default.join(b.context.path,j)))return!1}});case 3:return a.t0=function(a){return a.stat.isFile()&&b.preRender.fileBaseNames.includes(s.default.basename(a.name,s.default.extname(a.name)))},a.abrupt('return',a.sent.filter(a.t0));case 5:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.render=function(){var c=(0,l.default)(j.default.mark(function c(d,e){var g,i,k,m,n,p,r,s,t=this;return j.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.t0=w.default,c.t1=e,c.t2=d,c.next=5,b.getPrerendererFiles(d,e);case 5:return c.t3=c.sent,c.next=8,c.t0.callStack.call(c.t0,'prePreRendererRender',c.t1,c.t2,c.t3);case 8:g=c.sent,i=[],k=function(b){i.push(new h.default(function(){var c=(0,l.default)(j.default.mark(function c(g,h){var i,k,l,m,n,p;return j.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.t0=o.spawn,c.t1=b.path,c.t2=[d.preRender.cache],c.next=5,w.default.callStack('prePreRendererCLIParameter',e,d,[b.path]);case 5:c.t3=c.sent,c.t4=c.t2.concat.call(c.t2,c.t3),c.t5={cwd:a.cwd(),env:a.env,shell:!0,stdio:'inherit'},i=(0,c.t0)(c.t1,c.t4,c.t5),k=q.default.closeEventNames,l=Array.isArray(k),m=0,k=l?k:(0,f.default)(k);case 10:if(!l){c.next=16;break}if(!(m>=k.length)){c.next=13;break}return c.abrupt('break',24);case 13:n=k[m++],c.next=20;break;case 16:if(m=k.next(),!m.done){c.next=19;break}return c.abrupt('break',24);case 19:n=m.value;case 20:p=n,i.on(p,q.default.getProcessCloseHandler(g,d.server.proxy.optional?g:h));case 22:c.next=10;break;case 24:case'end':return c.stop();}},c,t)}));return function(){return c.apply(this,arguments)}}()))},m=g,n=Array.isArray(m),p=0,m=n?m:(0,f.default)(m);case 12:if(!n){c.next=18;break}if(!(p>=m.length)){c.next=15;break}return c.abrupt('break',26);case 15:r=m[p++],c.next=22;break;case 18:if(p=m.next(),!p.done){c.next=21;break}return c.abrupt('break',26);case 21:r=p.value;case 22:s=r,k(s);case 24:c.next=12;break;case 26:return c.next=28,h.default.all(i);case 28:return c.next=30,w.default.callStack('postPreRendererRender',e,d,g);case 30:return c.abrupt('return',c.sent);case 31:case'end':return c.stop();}},c,this)}));return function(){return c.apply(this,arguments)}}(),b}();b.default=x}).call(b,c(2))},function(a){function b(){throw new Error('setTimeout has not been defined')}function c(){throw new Error('clearTimeout has not been defined')}function d(a){if(j===setTimeout)return setTimeout(a,0);if((j===b||!j)&&setTimeout)return j=setTimeout,setTimeout(a,0);try{return j(a,0)}catch(b){try{return j.call(null,a,0)}catch(b){return j.call(this,a,0)}}}function e(a){if(k===clearTimeout)return clearTimeout(a);if((k===c||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(a);try{return k(a)}catch(b){try{return k.call(null,a)}catch(b){return k.call(this,a)}}}function f(){o&&m&&(o=!1,m.length?n=m.concat(n):p=-1,n.length&&g())}function g(){if(!o){var a=d(f);o=!0;for(var b=n.length;b;){for(m=n,n=[];++p<b;)m&&m[p].run();p=-1,b=n.length}m=null,o=!1,e(a)}}function h(a,b){this.fun=a,this.array=b}function i(){}var j,k,l=a.exports={};(function(){try{j='function'==typeof setTimeout?setTimeout:b}catch(a){j=b}try{k='function'==typeof clearTimeout?clearTimeout:c}catch(a){k=c}})();var m,n=[],o=!1,p=-1;l.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];n.push(new h(a,b)),1!==n.length||o||d(g)},h.prototype.run=function(){this.fun.apply(null,this.array)},l.title='browser',l.browser=!0,l.env={},l.argv=[],l.version='',l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error('process.binding is not supported')},l.cwd=function(){return'/'},l.chdir=function(){throw new Error('process.chdir is not supported')},l.umask=function(){return 0}},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d},function(a){a.exports=e},function(b){b.exports=a},function(a){a.exports=f},function(a){a.exports=g},function(a){a.exports=h},function(a){a.exports=i},function(a){a.exports=j},function(a){if('undefined'==typeof k){var b=new Error('Cannot find module "source-map-support/register"');throw b.code='MODULE_NOT_FOUND',b}a.exports=k}])});